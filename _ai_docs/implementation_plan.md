# 実装計画

## プロジェクトの制約 (GitHub Pages)
このプロジェクトは **GitHub Pages** での動作を前提としています。
1.  **プラグイン**: 標準サポート外のプラグイン（`jekyll-polyglot`等）を使用するため、**GitHub Actions** によるビルドとデプロイを行います。
2.  **環境**: GitHub Actions 上で Jekyll ビルドプロセスを実行し、静的ファイルを `gh-pages` ブランチ等にデプロイする構成とします。
3.  **動的機能**: サーバーサイドコード（PHP, Ruby on Rails等）は使用不可。クライアントサイドJSのみ。

---

## 提案する変更: 言語切り替え機能 (`default.html`)
現在、`default.html` の言語切り替えリンクは `page.permalink_lang` という独自の Frontmatter 定義に依存しており、これが定義されていないページでは切り替えボタンが表示されないか、機能しません。
これを `jekyll-polyglot` の標準的な挙動に合わせて汎用化します。

### 変更内容

#### `_layouts/default.html`
現在の `{% if page.permalink_lang %}` ブロックを修正し、以下のロジックを追加・変更します：
1.  **汎用的なリンク生成**: Frontmatter に定義がなくても、現在の URL (`page.url`) を基に対訳ページの URL を自動生成します。
    *   EN -> JA: `/website/` -> `/website/ja/`
    *   JA -> EN: `/website/ja/` -> `/website/`
2.  **既存ロジックの維持**: `permalink_lang` が明示的にある場合はそれを優先します（`index.md` のような特殊なパス用）。

### 検証計画
1.  `permalink_lang` がないページ（例: `datasets.md`）を開き、言語切り替えリンクが表示されるか確認。
2.  リンクをクリックして、正しい言語のページ (`/website/ja/datasets/` 等) に遷移するか確認。

## 提案する変更: 各ページの多言語化

### 対象ページ
ユーザーの要望に応じ、順次対応します。
1.  `datasets.md`
2.  `access_methods/` 配下のページ
3.  `statistics.md` (確認)

### 方法
ページの内容に応じて、以下のいずれかの方法を採用します。
*   **方法A**: 1つのファイル内で `{% lang en %}...{% endlang %}` タグを使用（小規模な変更で済む場合）。
*   **方法B**: `filename.en.md` と `filename.ja.md` に分割（コンテンツ量が大きく異なる場合）。

---

## 提案する変更: News と Logs の多言語化

### 課題
現在、`_news` と `_logs` コレクションは `_config.yml` の `defaults` 設定により、全ての記事が強制的に `lang: ja`（日本語）として扱われています。
多言語対応（英語/日本語）するためには、記事ごとに言語を指定できる柔軟な構成が必要です。

### 方針
**記事単位での分割 (Duplicate Strategy)** を採用します。
`jekyll-polyglot` は、ビルド時に `lang` Frontmatter に基づいて各言語のサイトに含める記事を自動的にフィルタリングします。

### 具体的な手順

1.  **`_config.yml` の修正**
    *   `news` と `logs` コレクションに対する `lang: ja` のデフォルト設定を削除します。デフォルトはサイト全体の設定 (`lang: en`) に従い、個別に上書き可能にします。

2.  **記事ファイルの構成変更**
    *   ニュース・ログ記事を「英語記事」と「日本語記事」の2つのファイルとして作成します。
    *   **ファイル名の命名規則**:
        *   日本語: `YYYY-MM-DD-title.ja.md`
        *   英語: `YYYY-MM-DD-title.en.md`

3.  **Frontmatter の設定**
    *   各記事ファイルに `lang` を明示します。
    *   同じ内容の記事同士を関連付けるため、任意の共通ID（例: `uuid` や `group_id`）か、単純にファイル名で管理します（Polyglotは基本フィルタリングのみで、記事間のリンクは手動またはデザイン次第）。
    *   **注意**: ニュースやログは時系列データであり、必ずしも「対訳」が1対1で存在しなくても良いため（例: 日本国内向けのお知らせ）、厳密な相互リンクは必須としません。ただし、重要なニュースは両言語で用意することを推奨します。

### 表示側の修正
*   `index.md` や `news.html` (もしあれば) でのループ処理は変更不要です。`jekyll-polyglot` が `site.news` や `site.logs` を現在のアクティブ言語の記事だけに自動的にフィルタリングしてくれます。

### 言語切り替えボタンの表示制御 (`default.html`)
「対訳が存在しない場合はボタンを表示しない」という要件に対応するため、以下のロジックを実装します。

1.  **通常ページ (`pages`) の場合**:
    *   常にボタンを表示（または `permalink_lang` 等で制御）。現状のロジックを維持。

2.  **コレクション (`news`, `logs`) の場合**:
    *   記事の関連付けは、同一の「ファイル名（拡張子と言語コードを除くベース名）」または「Frontmatter の ID」で行います。
    *   今回はシンプルに **「URLパスの類似性」** または **「ファイル名の類似性」** で判定します。
    *   具体的には、現在表示中の記事に対して、対になる言語の記事がコレクション内に存在するかを `site.news` や `site.logs` から検索します。存在確認が取れた場合のみボタンを表示します。

---

<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if page.title %}{{ page.title }} - {{ site.title }}{% else %}{{ site.title }}{% endif %}</title>
  <meta name="description"
    content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
  <script type="text/javascript" data-width="auto" data-color="mono"
    src="https://dbcls.rois.ac.jp/DBCLS-common-header-footer/common-header-and-footer/script/common-header-and-footer.js"
    style="display: block" id="common-header-and-footer__script"></script>
</head>

<body{% if page.pageId %} data-page-id="{{ page.pageId }}" {% endif %}{% if page.parentPageId %}
  data-parent-page-id="{{ page.parentPageId }}" {% endif %}>
  {% assign current_lang = page.lang | default: site.default_lang %}
  {% assign global_nav_i18n = site.data.i18n.global_nav[current_lang] | default:
  site.data.i18n.global_nav[site.default_lang] %}
  {% assign canonical_path = page.permalink | default: page.url | default: '/' %}
  {% if canonical_path == '' %}
  {% assign canonical_path = '/' %}
  {% endif %}
  {% assign first_char = canonical_path | slice: 0, 1 %}
  {% unless first_char == '/' %}
  {% assign canonical_path = '/' | append: canonical_path %}
  {% endunless %}
  {% if current_lang != site.default_lang %}
  {% assign lang_prefix = '/' | append: current_lang %}
  {% assign lang_prefix_with_slash = lang_prefix | append: '/' %}
  {% assign lang_prefix_length = lang_prefix_with_slash | size %}
  {% assign path_prefix = canonical_path | slice: 0, lang_prefix_length %}
  {% if canonical_path == lang_prefix %}
  {% assign canonical_path = '/' %}
  {% elsif path_prefix == lang_prefix_with_slash %}
  {% assign canonical_path = canonical_path | replace_first: lang_prefix_with_slash, '/' %}
  {% endif %}
  {% endif %}
  {% assign counterpart_lang = '' %}
  {% assign counterpart_href = '' %}
  {% if page.permalink_lang %}
  {% for lang_code in site.languages %}
  {% if lang_code == current_lang %}
  {% continue %}
  {% endif %}
  {% assign lang_permalink = page.permalink_lang[lang_code] %}
  {% unless lang_permalink %}
  {% continue %}
  {% endunless %}
  {% capture lang_href %}/{{ lang_code }}{% if lang_permalink == '/' %}/{% else %}{{ lang_permalink }}{% endif %}{%
  endcapture %}
  {% assign counterpart_lang = lang_code %}
  {% assign counterpart_href = lang_href | replace: '//', '/' %}
  {% break %}
  {% endfor %}
  {% endif %}
  <aside class="global-navigation">
    <div class="background"></div>
    <div class="inner">
      <h1>
        <a href="{{ '/' | relative_url }}">
          <img src="{{ '/assets/images/logo.svg' | relative_url }}" alt="RDF Portal Logo">
          <span>RDF<br>Portal</span>
        </a>
      </h1>
      <ul class="stats">
        <li><span>{{ site.data.datasets | size }}</span><span>{{ global_nav_i18n.stats.datasets_label }}</span></li>
        {% assign total_triples = 0 %}
        {% assign datasets = site.data.datasets | default: empty %}
        {% for d in datasets %}
        {% assign t = d.statistics.number_of_triples | default: 0 %}
        {% assign total_triples = total_triples | plus: t %}
        {% endfor %}
        {% comment %} Format into million/billion/trillion with one decimal when appropriate {% endcomment %}
        {% if total_triples >= 1000000000000 %}
        {% assign unit_div10 = 100000000000 %}
        {% assign scaled10 = total_triples | divided_by: unit_div10 %}
        {% assign intpart = scaled10 | divided_by: 10 %}
        {% assign dec = scaled10 | modulo: 10 %}
        {% if dec == 0 %}
        {% assign display = intpart %}
        {% else %}
        {% assign display = intpart | append: '.' | append: dec %}
        {% endif %}
        <li><span>{{ display }}</span><span>{{ global_nav_i18n.stats.triples_trillion }}</span></li>
        {% elsif total_triples >= 1000000000 %}
        {% assign unit_div10 = 100000000 %}
        {% assign scaled10 = total_triples | divided_by: unit_div10 %}
        {% assign intpart = scaled10 | divided_by: 10 %}
        {% assign dec = scaled10 | modulo: 10 %}
        {% if dec == 0 %}
        {% assign display = intpart %}
        {% else %}
        {% assign display = intpart | append: '.' | append: dec %}
        {% endif %}
        <li><span>{{ display }}</span><span>{{ global_nav_i18n.stats.triples_billion }}</span></li>
        {% elsif total_triples >= 1000000 %}
        {% assign unit_div10 = 100000 %}
        {% assign scaled10 = total_triples | divided_by: unit_div10 %}
        {% assign intpart = scaled10 | divided_by: 10 %}
        {% assign dec = scaled10 | modulo: 10 %}
        {% if dec == 0 %}
        {% assign display = intpart %}
        {% else %}
        {% assign display = intpart | append: '.' | append: dec %}
        {% endif %}
        <li><span>{{ display }}</span><span>{{ global_nav_i18n.stats.triples_million }}</span></li>
        {% else %}
        <li><span>{{ total_triples | default: 0 }}</span><span>{{ global_nav_i18n.stats.triples_plain }}</span></li>
        {% endif %}
      </ul>
      {% include nav.html %}
      <div class="space"></div>
      <div class="bottom">
        <p>© {{ site.time | date: "%Y" }} RDF Portal</p>
        <p><a href="{{ '/site-policy/' | relative_url }}">Site Policy</a></p>
        <span class="spacer"></span>
        {% if counterpart_lang != '' and counterpart_href != '' %}
        {% case counterpart_lang %}
        {% when 'ja' %}
        {% assign counterpart_label = '日本語' %}
        {% when 'en' %}
        {% assign counterpart_label = 'English' %}
        {% else %}
        {% assign counterpart_label = counterpart_lang | upcase %}
        {% endcase %}
        <div data-current-lang="{{ current_lang }}">
          <a href="{{ counterpart_href | relative_url }}"
            aria-label="{{ global_nav_i18n.language_switcher.aria_label }}" data-lang="{{ counterpart_lang }}">
            {{ counterpart_label }}
          </a>
        </div>
        {% endif %}
      </div>
    </div>
  </aside>

  <main>
    {{ content }}
  </main>

  <!-- モバイルメニュー関連のJSは削除済み -->

  <!-- ベースURLをJavaScriptで利用可能にする（全ページ共通） -->
  <script>
    window.SITE_BASE_URL = '{{ site.baseurl }}';
    // URLパラメータ font=roman などがあれば body に data-font="roman" を付与する
    (function () {
      try {
        var params = new URLSearchParams(window.location.search || '');
        var f = params.get('font');
        if (f) {
          // 簡易サニタイズ（英数字と _- のみ許可、小文字化）
          var safe = String(f).toLowerCase().replace(/[^a-z0-9_-]/g, '');
          if (safe && document && document.body) document.body.setAttribute('data-font', safe);
        }
      } catch (e) {
        /* noop */
      }
    })();
  </script>

  <!-- DatasetsManagerシングルトンクラス（全ページ共通） -->
  <script defer src="{{ '/assets/js/DatasetsManager.js' | relative_url }}"></script>

  <!-- DatasetIcon（アイコン生成ロジック） - DatasetsManager の後、DatasetCard の前に読み込む -->
  <script defer src="{{ '/assets/js/DatasetIcon.js' | relative_url }}"></script>

  <!-- DatasetCardコンポーネント（全ページ共通） -->
  <script defer src="{{ '/assets/js/DatasetCard.js' | relative_url }}"></script>

  <!-- トップページ専用のJavaScript -->
  {% if page.title == 'Top' %}
  <script defer src="{{ '/assets/js/top-page-tiles.js' | relative_url }}"></script>
  {% endif %}
  </body>

</html>
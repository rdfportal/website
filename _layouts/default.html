{% assign current_lang = site.active_lang | default: page.lang | default: site.default_lang %}
<!DOCTYPE html>
<html lang="{{ current_lang | escape }}">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if page.title %}{{ page.title }} - {{ site.title }}{% else %}{{ site.title }}{% endif %}</title>
  <meta name="description"
    content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
  <script type="text/javascript" data-width="auto" data-color="mono"
    src="https://dbcls.rois.ac.jp/DBCLS-common-header-footer/common-header-and-footer/script/common-header-and-footer.js"
    style="display: block" id="common-header-and-footer__script"></script>
</head>

<body{% if page.pageId %} data-page-id="{{ page.pageId }}" {% endif %}{% if page.parentPageId %}
  data-parent-page-id="{{ page.parentPageId }}" {% endif %}>
  {% assign canonical_path = page.permalink | default: page.url | default: '/' %}
  {% if canonical_path == '' %}
  {% assign canonical_path = '/' %}
  {% endif %}
  {% assign first_char = canonical_path | slice: 0, 1 %}
  {% unless first_char == '/' %}
  {% assign canonical_path = '/' | append: canonical_path %}
  {% endunless %}
  {% if current_lang != site.default_lang %}
  {% assign lang_prefix = '/' | append: current_lang %}
  {% assign lang_prefix_with_slash = lang_prefix | append: '/' %}
  {% assign lang_prefix_length = lang_prefix_with_slash | size %}
  {% assign path_prefix = canonical_path | slice: 0, lang_prefix_length %}
  {% if canonical_path == lang_prefix %}
  {% assign canonical_path = '/' %}
  {% elsif path_prefix == lang_prefix_with_slash %}
  {% assign canonical_path = canonical_path | replace_first: lang_prefix_with_slash, '/' %}
  {% endif %}
  {% endif %}
  {% assign counterpart_lang = '' %}
  {% assign counterpart_href = '' %}
  {% if page.permalink_lang %}
  {% for lang_code in site.languages %}
  {% if lang_code == current_lang %}
  {% continue %}
  {% endif %}
  {% assign canonical_lang_path = page.permalink_lang[lang_code] | default: '/' %}
  {% assign lang_href = canonical_lang_path %}
  {% if lang_code != site.default_lang %}
  {% if canonical_lang_path == '/' %}
  {% assign lang_href = '/' | append: lang_code | append: '/' %}
  {% else %}
  {% assign lang_href = '/' | append: lang_code | append: canonical_lang_path %}
  {% endif %}
  {% endif %}
  {% assign counterpart_lang = lang_code %}
  {% assign lang_href_clean = lang_href | strip %}
  {% assign counterpart_href = lang_href_clean | replace: '//', '/' %}
  {% break %}
  {% endfor %}
  {% endif %}
  <aside class="global-navigation">
    <div class="background"></div>
    <div class="inner">
      <h1>
        <a href="{{ '/' | relative_url }}">
          <img src="{{ '/assets/images/logo.svg' | relative_url }}" alt="RDF Portal Logo">
          <span>RDF<br>Portal</span>
        </a>
      </h1>
      <ul class="stats">
        <li><span>{{ site.data.datasets | size }}</span><span>RDF dataset</span></li>
        {% assign total_triples = 0 %}
        {% assign datasets = site.data.datasets | default: empty %}
        {% for d in datasets %}
        {% assign t = d.statistics.number_of_triples | default: 0 %}
        {% assign total_triples = total_triples | plus: t %}
        {% endfor %}
        {% comment %} Format into million/billion/trillion with one decimal when appropriate {% endcomment %}
        {% if total_triples >= 1000000000000 %}
        {% assign unit_div10 = 100000000000 %}
        {% assign scaled10 = total_triples | divided_by: unit_div10 %}
        {% assign intpart = scaled10 | divided_by: 10 %}
        {% assign dec = scaled10 | modulo: 10 %}
        {% if dec == 0 %}
        {% assign display = intpart %}
        {% else %}
        {% assign display = intpart | append: '.' | append: dec %}
        {% endif %}
        <li><span>{{ display }}</span><span>trillion triples</span></li>
        {% elsif total_triples >= 1000000000 %}
        {% assign unit_div10 = 100000000 %}
        {% assign scaled10 = total_triples | divided_by: unit_div10 %}
        {% assign intpart = scaled10 | divided_by: 10 %}
        {% assign dec = scaled10 | modulo: 10 %}
        {% if dec == 0 %}
        {% assign display = intpart %}
        {% else %}
        {% assign display = intpart | append: '.' | append: dec %}
        {% endif %}
        <li><span>{{ display }}</span><span>billion triples</span></li>
        {% elsif total_triples >= 1000000 %}
        {% assign unit_div10 = 100000 %}
        {% assign scaled10 = total_triples | divided_by: unit_div10 %}
        {% assign intpart = scaled10 | divided_by: 10 %}
        {% assign dec = scaled10 | modulo: 10 %}
        {% if dec == 0 %}
        {% assign display = intpart %}
        {% else %}
        {% assign display = intpart | append: '.' | append: dec %}
        {% endif %}
        <li><span>{{ display }}</span><span>million triples</span></li>
        {% else %}
        <li><span>{{ total_triples | default: 0 }}</span><span>triples</span></li>
        {% endif %}
      </ul>
      {% include nav.html %}
      <div class="space"></div>
      <div class="bottom">
        <p>© {{ site.time | date: "%Y" }} RDF Portal</p>
        <p><a href="{{ '/site-policy/' | relative_url }}">Site Policy</a></p>
        <span class="spacer"></span>
        {% if counterpart_lang != '' and counterpart_href != '' %}
        {% case counterpart_lang %}
        {% when 'ja' %}
        {% assign counterpart_label = '日本語' %}
        {% when 'en' %}
        {% assign counterpart_label = 'English' %}
        {% else %}
        {% assign counterpart_label = counterpart_lang | upcase %}
        {% endcase %}
        <div data-current-lang="{{ current_lang }}">
          <a href="#" aria-label="Change language" data-lang="{{ counterpart_lang }}"
            data-switch-target="{{ counterpart_href }}">
            {{ counterpart_label }}
          </a>
        </div>
        {% endif %}
      </div>
    </div>
  </aside>

  <main>
    {{ content }}
  </main>

  <!-- モバイルメニュー関連のJSは削除済み -->

  <!-- ベースURLをJavaScriptで利用可能にする（全ページ共通） -->
  <script>
    window.SITE_BASE_URL = '{{ site.baseurl }}';
    window.SITE_BASE_URL_ROOT = '{{ site.config.baseurl | default: site.baseurl }}';

    // URLパラメータ font=roman などがあれば body に data-font="roman" を付与する
    (function () {
      try {
        var params = new URLSearchParams(window.location.search || '');
        var f = params.get('font');
        if (f) {
          // 簡易サニタイズ（英数字と _- のみ許可、小文字化）
          var safe = String(f).toLowerCase().replace(/[^a-z0-9_-]/g, '');
          if (safe && document && document.body) document.body.setAttribute('data-font', safe);
        }
      } catch (e) {
        /* noop */
      }
    })();

    (function () {
      try {
        var switcher = document.querySelector('.global-navigation .bottom [data-switch-target]');
        if (!switcher) return;
        var rawTarget = switcher.getAttribute('data-switch-target');
        if (!rawTarget) return;
        var normalized = String(rawTarget).trim();
        if (!normalized) return;
        if (normalized.charAt(0) !== '/') {
          normalized = '/' + normalized;
        }
        var baseRoot = window.SITE_BASE_URL_ROOT || window.SITE_BASE_URL || '';
        baseRoot = String(baseRoot || '').replace(/\/+$/, '');
        if (baseRoot === '/') baseRoot = '';
        var hrefPath = baseRoot + normalized;
        if (!hrefPath) hrefPath = normalized;
        var origin = (window.location && window.location.origin) ? window.location.origin.replace(/\/+$/, '') : '';
        var finalHref = origin ? origin + hrefPath : hrefPath;
        switcher.setAttribute('href', finalHref);
      } catch (e) {
        /* noop */
      }
    })();
  </script>
  </body>

</html>